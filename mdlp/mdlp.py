from Crypto.Util.number import *
from sage.all import *
p = 94413310751917369305079812653655619566021075449954923397392050181976939189891
A = [[38199337272663519912859864066101528484023656231849338967558894235177040565160,
      39708167173513090810083500967474691943646789486489990958101592717502452906918],
     [8216211510625558273096642057121313417997488994504871245106775381995665925783,
      56213973479253849392219948587554091081997419218105584429833155946799898624740]]
Q = [[61709241598677561125021718690991651934557899286972116933820920757636771220273,
      1945367449329759288724720626216309893787847192907494307536759223359193510642],
     [37495232301500074672571996664644922614693962264764098174213150757616575323566,
      7348269231944161963123250652171976847627786311806728904368575861561449853500]]
C = [[47566868540912475779105819546118874217903268597017385039977593878486632022506,
      86073162301954995219912739344010659248720823814557810528618517154406350653517],
     [23443866424088482893369441934221448179896589659663581973508963775891809430857,
      74567333640177484678138574534395714128854315440076840728428649074147859070975]]
E = [[56937964695156855099385034285428853461603799261684034842341841781057485084327,
      82459328835322885824854425864023809222717401981993182346342472865578156162544],
     [85092677346274708324092648597361729755305119435989183201786866456596369562681,
      22228861714953585357281182780002271505668586948202416054453861940155538803489]]

alpha = IntegerModRing(p)
M = MatrixSpace(alpha, 2, 2)

A = M(A)
Q = M(Q)
C = M(C)
E = M(E)

J, P = A.jordan_form(transformation=True)
j_r = ~P*C*P

print(J)
print("###############################################################################################")
print(j_r)

print(discrete_log(alpha(j_r[1][1]), alpha(J[1][1])))
r = 69061912195510167079715687878036583056625139896259969453538571762984613555627
D = Q**r
Mes = ~D*E
print(Mes)
print(''.join([long_to_bytes(1324955255054937770134747290094387).decode(),
              long_to_bytes(2461719072681758828457118900962669).decode(),
              long_to_bytes(1932074164876896107376993304522820).decode(),
              long_to_bytes(677971303745800032818513197408637).decode()]))
